#tag Window
Begin Window frmMain
   BackColor       =   16777215
   Backdrop        =   ""
   CloseButton     =   True
   Composite       =   True
   Frame           =   11
   FullScreen      =   False
   HasBackColor    =   False
   Height          =   5.4e+2
   ImplicitInstance=   True
   LiveResize      =   True
   MacProcID       =   0
   MaxHeight       =   32000
   MaximizeButton  =   False
   MaxWidth        =   32000
   MenuBar         =   386073714
   MenuBarVisible  =   True
   MinHeight       =   64
   MinimizeButton  =   True
   MinWidth        =   64
   Placement       =   0
   Resizeable      =   False
   Title           =   "yeelink(TM)串口服务器"
   Visible         =   True
   Width           =   6.92e+2
   Begin GroupBox grpSerial
      AutoDeactivate  =   True
      Bold            =   ""
      Caption         =   "串口设置"
      Enabled         =   True
      Height          =   74
      HelpTag         =   ""
      Index           =   -2147483648
      InitialParent   =   ""
      Italic          =   ""
      Left            =   20
      LockBottom      =   ""
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   ""
      LockTop         =   True
      Scope           =   0
      TabIndex        =   0
      TabPanelIndex   =   0
      TextFont        =   "System"
      TextSize        =   0
      TextUnit        =   0
      Top             =   14
      Underline       =   ""
      Visible         =   True
      Width           =   643
      Begin ComboBox cbxSerial
         AutoComplete    =   True
         AutoDeactivate  =   True
         Bold            =   ""
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Height          =   20
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "grpSerial"
         InitialValue    =   ""
         Italic          =   ""
         Left            =   106
         ListIndex       =   0
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Scope           =   0
         TabIndex        =   0
         TabPanelIndex   =   0
         TabStop         =   True
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   48
         Underline       =   ""
         UseFocusRing    =   True
         Visible         =   True
         Width           =   158
      End
      Begin Label Label1
         AutoDeactivate  =   True
         Bold            =   ""
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Height          =   20
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "grpSerial"
         Italic          =   ""
         Left            =   32
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Multiline       =   ""
         Scope           =   0
         Selectable      =   False
         TabIndex        =   2
         TabPanelIndex   =   0
         Text            =   "串口设备"
         TextAlign       =   2
         TextColor       =   0
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   48
         Transparent     =   False
         Underline       =   ""
         Visible         =   True
         Width           =   56
      End
      Begin Label Label2
         AutoDeactivate  =   True
         Bold            =   ""
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Height          =   20
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "grpSerial"
         Italic          =   ""
         Left            =   283
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Multiline       =   ""
         Scope           =   0
         Selectable      =   False
         TabIndex        =   4
         TabPanelIndex   =   0
         Text            =   "波特率"
         TextAlign       =   2
         TextColor       =   0
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   48
         Transparent     =   False
         Underline       =   ""
         Visible         =   True
         Width           =   48
      End
      Begin ComboBox cbxBaud
         AutoComplete    =   True
         AutoDeactivate  =   True
         Bold            =   ""
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Height          =   20
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "grpSerial"
         InitialValue    =   ""
         Italic          =   ""
         Left            =   343
         ListIndex       =   0
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Scope           =   0
         TabIndex        =   1
         TabPanelIndex   =   0
         TabStop         =   True
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   48
         Underline       =   ""
         UseFocusRing    =   True
         Visible         =   True
         Width           =   111
      End
      Begin PushButton btnSerial
         AutoDeactivate  =   False
         Bold            =   ""
         ButtonStyle     =   0
         Cancel          =   ""
         Caption         =   "连接"
         Default         =   False
         Enabled         =   False
         Height          =   20
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "grpSerial"
         Italic          =   ""
         Left            =   479
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Scope           =   0
         TabIndex        =   3
         TabPanelIndex   =   0
         TabStop         =   True
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   48
         Underline       =   ""
         Visible         =   True
         Width           =   80
      End
   End
   Begin GroupBox grpServer
      AutoDeactivate  =   True
      Bold            =   ""
      Caption         =   "传感器设置"
      Enabled         =   True
      Height          =   86
      HelpTag         =   ""
      Index           =   -2147483648
      InitialParent   =   ""
      Italic          =   ""
      Left            =   18
      LockBottom      =   ""
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   ""
      LockTop         =   True
      Scope           =   0
      TabIndex        =   1
      TabPanelIndex   =   0
      TextFont        =   "System"
      TextSize        =   0
      TextUnit        =   0
      Top             =   99
      Underline       =   ""
      Visible         =   True
      Width           =   645
      Begin Label Label3
         AutoDeactivate  =   True
         Bold            =   ""
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Height          =   20
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "grpServer"
         Italic          =   ""
         Left            =   32
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Multiline       =   ""
         Scope           =   0
         Selectable      =   False
         TabIndex        =   5
         TabPanelIndex   =   0
         Text            =   "设备编号"
         TextAlign       =   2
         TextColor       =   0
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   125
         Transparent     =   False
         Underline       =   ""
         Visible         =   True
         Width           =   56
      End
      Begin Label Label4
         AutoDeactivate  =   True
         Bold            =   ""
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Height          =   20
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "grpServer"
         Italic          =   ""
         Left            =   206
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Multiline       =   ""
         Scope           =   0
         Selectable      =   False
         TabIndex        =   6
         TabPanelIndex   =   0
         Text            =   "API Key"
         TextAlign       =   2
         TextColor       =   0
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   155
         Transparent     =   False
         Underline       =   ""
         Visible         =   True
         Width           =   63
      End
      Begin TextField txtDeviceID
         AcceptTabs      =   ""
         Alignment       =   3
         AutoDeactivate  =   True
         AutomaticallyCheckSpelling=   False
         BackColor       =   16777215
         Bold            =   ""
         Border          =   True
         CueText         =   "Device ID"
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Format          =   ""
         Height          =   22
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "grpServer"
         Italic          =   ""
         Left            =   106
         LimitText       =   0
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Mask            =   ""
         Password        =   ""
         ReadOnly        =   ""
         Scope           =   0
         TabIndex        =   0
         TabPanelIndex   =   0
         TabStop         =   True
         Text            =   60
         TextColor       =   0
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   125
         Underline       =   ""
         UseFocusRing    =   True
         Visible         =   True
         Width           =   66
      End
      Begin TextField txtKEY
         AcceptTabs      =   ""
         Alignment       =   0
         AutoDeactivate  =   True
         AutomaticallyCheckSpelling=   False
         BackColor       =   16777215
         Bold            =   ""
         Border          =   True
         CueText         =   "API密钥"
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Format          =   ""
         Height          =   22
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "grpServer"
         Italic          =   ""
         Left            =   283
         LimitText       =   0
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Mask            =   ""
         Password        =   True
         ReadOnly        =   ""
         Scope           =   0
         TabIndex        =   3
         TabPanelIndex   =   0
         TabStop         =   True
         Text            =   "89501b438791e28f74c21035a88fffd2"
         TextColor       =   0
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   155
         Underline       =   ""
         UseFocusRing    =   True
         Visible         =   True
         Width           =   222
      End
      Begin CheckBox chkShowKey
         AutoDeactivate  =   True
         Bold            =   ""
         Caption         =   "显示"
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Height          =   20
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "grpServer"
         Italic          =   ""
         Left            =   514
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Scope           =   0
         State           =   0
         TabIndex        =   4
         TabPanelIndex   =   0
         TabStop         =   True
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   155
         Underline       =   ""
         Value           =   False
         Visible         =   True
         Width           =   53
      End
      Begin TextField txtSensorID
         AcceptTabs      =   ""
         Alignment       =   3
         AutoDeactivate  =   True
         AutomaticallyCheckSpelling=   False
         BackColor       =   16777215
         Bold            =   ""
         Border          =   True
         CueText         =   "Sensor ID"
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Format          =   ""
         Height          =   22
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "grpServer"
         Italic          =   ""
         Left            =   283
         LimitText       =   0
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Mask            =   ""
         Password        =   ""
         ReadOnly        =   ""
         Scope           =   0
         TabIndex        =   1
         TabPanelIndex   =   0
         TabStop         =   True
         Text            =   54
         TextColor       =   0
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   125
         Underline       =   ""
         UseFocusRing    =   True
         Visible         =   True
         Width           =   66
      End
      Begin Label Label8
         AutoDeactivate  =   True
         Bold            =   ""
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Height          =   20
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "grpServer"
         Italic          =   ""
         Left            =   196
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Multiline       =   ""
         Scope           =   0
         Selectable      =   False
         TabIndex        =   7
         TabPanelIndex   =   0
         Text            =   "传感器编号"
         TextAlign       =   2
         TextColor       =   0
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   125
         Transparent     =   False
         Underline       =   ""
         Visible         =   True
         Width           =   75
      End
      Begin TextField txtMsgFilter
         AcceptTabs      =   ""
         Alignment       =   3
         AutoDeactivate  =   True
         AutomaticallyCheckSpelling=   False
         BackColor       =   16777215
         Bold            =   ""
         Border          =   True
         CueText         =   "传感器数据字头"
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Format          =   ""
         Height          =   22
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "grpServer"
         Italic          =   ""
         Left            =   106
         LimitText       =   0
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Mask            =   ""
         Password        =   ""
         ReadOnly        =   ""
         Scope           =   0
         TabIndex        =   2
         TabPanelIndex   =   0
         TabStop         =   True
         Text            =   "value"
         TextColor       =   0
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   155
         Underline       =   ""
         UseFocusRing    =   True
         Visible         =   True
         Width           =   66
      End
      Begin Label Label9
         AutoDeactivate  =   True
         Bold            =   ""
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Height          =   20
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "grpServer"
         Italic          =   ""
         Left            =   29
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Multiline       =   ""
         Scope           =   0
         Selectable      =   False
         TabIndex        =   8
         TabPanelIndex   =   0
         Text            =   "数据标识"
         TextAlign       =   2
         TextColor       =   0
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   155
         Transparent     =   False
         Underline       =   ""
         Visible         =   True
         Width           =   59
      End
      Begin TextField txtAPIVer
         AcceptTabs      =   ""
         Alignment       =   3
         AutoDeactivate  =   True
         AutomaticallyCheckSpelling=   False
         BackColor       =   16777215
         Bold            =   ""
         Border          =   True
         CueText         =   "API Version"
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Format          =   ""
         Height          =   22
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "grpServer"
         Italic          =   ""
         Left            =   459
         LimitText       =   0
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Mask            =   ""
         Password        =   ""
         ReadOnly        =   ""
         Scope           =   0
         TabIndex        =   9
         TabPanelIndex   =   0
         TabStop         =   True
         Text            =   "v1.0"
         TextColor       =   0
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   125
         Underline       =   ""
         UseFocusRing    =   True
         Visible         =   True
         Width           =   46
      End
      Begin Label Label10
         AutoDeactivate  =   True
         Bold            =   ""
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Height          =   20
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "grpServer"
         Italic          =   ""
         Left            =   372
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Multiline       =   ""
         Scope           =   0
         Selectable      =   False
         TabIndex        =   10
         TabPanelIndex   =   0
         Text            =   "API版本"
         TextAlign       =   2
         TextColor       =   0
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   125
         Transparent     =   False
         Underline       =   ""
         Visible         =   True
         Width           =   75
      End
   End
   Begin GroupBox GroupBox2
      AutoDeactivate  =   True
      Bold            =   ""
      Caption         =   "联机日志"
      Enabled         =   True
      Height          =   258
      HelpTag         =   ""
      Index           =   -2147483648
      InitialParent   =   ""
      Italic          =   ""
      Left            =   20
      LockBottom      =   ""
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   ""
      LockTop         =   True
      Scope           =   0
      TabIndex        =   3
      TabPanelIndex   =   0
      TextFont        =   "System"
      TextSize        =   0
      TextUnit        =   0
      Top             =   197
      Underline       =   ""
      Visible         =   True
      Width           =   302
      Begin TextArea txtLog
         AcceptTabs      =   ""
         Alignment       =   0
         AutoDeactivate  =   True
         AutomaticallyCheckSpelling=   True
         BackColor       =   0
         Bold            =   ""
         Border          =   True
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Format          =   ""
         Height          =   217
         HelpTag         =   ""
         HideSelection   =   True
         Index           =   -2147483648
         InitialParent   =   "GroupBox2"
         Italic          =   ""
         Left            =   32
         LimitText       =   0
         LockBottom      =   True
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   True
         LockTop         =   True
         Mask            =   ""
         Multiline       =   True
         ReadOnly        =   True
         Scope           =   0
         ScrollbarHorizontal=   True
         ScrollbarVertical=   True
         Styled          =   True
         TabIndex        =   0
         TabPanelIndex   =   0
         TabStop         =   True
         Text            =   ""
         TextColor       =   16776960
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   223
         Underline       =   ""
         UseFocusRing    =   True
         Visible         =   True
         Width           =   274
      End
   End
   Begin GroupBox GroupBox3
      AutoDeactivate  =   True
      Bold            =   ""
      Caption         =   "服务器联机测试"
      Enabled         =   True
      Height          =   281
      HelpTag         =   ""
      Index           =   -2147483648
      InitialParent   =   ""
      Italic          =   ""
      Left            =   343
      LockBottom      =   ""
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   ""
      LockTop         =   True
      Scope           =   0
      TabIndex        =   4
      TabPanelIndex   =   0
      TextFont        =   "System"
      TextSize        =   0
      TextUnit        =   0
      Top             =   197
      Underline       =   ""
      Visible         =   True
      Width           =   320
      Begin TextArea txtTestData
         AcceptTabs      =   ""
         Alignment       =   0
         AutoDeactivate  =   True
         AutomaticallyCheckSpelling=   True
         BackColor       =   16777215
         Bold            =   ""
         Border          =   True
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Format          =   ""
         Height          =   208
         HelpTag         =   ""
         HideSelection   =   True
         Index           =   -2147483648
         InitialParent   =   "GroupBox3"
         Italic          =   ""
         Left            =   354
         LimitText       =   0
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Mask            =   ""
         Multiline       =   True
         ReadOnly        =   ""
         Scope           =   0
         ScrollbarHorizontal=   ""
         ScrollbarVertical=   True
         Styled          =   True
         TabIndex        =   0
         TabPanelIndex   =   0
         TabStop         =   True
         Text            =   ""
         TextColor       =   0
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   223
         Underline       =   ""
         UseFocusRing    =   True
         Visible         =   True
         Width           =   286
         Begin Serial Serial1
            Baud            =   8
            Bits            =   3
            CTS             =   ""
            DTR             =   ""
            Height          =   32
            Index           =   -2147483648
            InitialParent   =   "txtTestData"
            Left            =   395
            LockedInPosition=   False
            Parity          =   0
            Scope           =   0
            Stop            =   0
            TabPanelIndex   =   0
            Top             =   266
            Width           =   32
            XON             =   ""
         End
         Begin HTTPSocket HTTPSocket1
            Address         =   ""
            Height          =   32
            Index           =   -2147483648
            InitialParent   =   "txtTestData"
            Left            =   427
            LockedInPosition=   False
            Port            =   80
            Scope           =   0
            TabPanelIndex   =   0
            Top             =   266
            Width           =   32
            yield           =   0
         End
         Begin Timer Timer1
            Height          =   32
            Index           =   -2147483648
            InitialParent   =   "txtTestData"
            Left            =   468
            LockedInPosition=   False
            Mode            =   2
            Period          =   300
            Scope           =   0
            TabPanelIndex   =   0
            Top             =   267
            Width           =   32
         End
         Begin Timer tmrClearLog
            Height          =   32
            Index           =   -2147483648
            InitialParent   =   "txtTestData"
            Left            =   512
            LockedInPosition=   False
            Mode            =   2
            Period          =   900000
            Scope           =   0
            TabPanelIndex   =   0
            Top             =   266
            Width           =   32
         End
      End
      Begin PushButton btnSend
         AutoDeactivate  =   True
         Bold            =   ""
         ButtonStyle     =   0
         Cancel          =   ""
         Caption         =   "发送"
         Default         =   ""
         Enabled         =   False
         Height          =   20
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "GroupBox3"
         Italic          =   ""
         Left            =   587
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Scope           =   0
         TabIndex        =   1
         TabPanelIndex   =   0
         TabStop         =   True
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   443
         Underline       =   ""
         Visible         =   True
         Width           =   49
      End
      Begin PushButton btnClear
         AutoDeactivate  =   True
         Bold            =   ""
         ButtonStyle     =   0
         Cancel          =   ""
         Caption         =   "清除"
         Default         =   ""
         Enabled         =   False
         Height          =   20
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "GroupBox3"
         Italic          =   ""
         Left            =   521
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Scope           =   0
         TabIndex        =   2
         TabPanelIndex   =   0
         TabStop         =   True
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   443
         Underline       =   ""
         Visible         =   True
         Width           =   54
      End
      Begin CheckBox chkBatch
         AutoDeactivate  =   True
         Bold            =   ""
         Caption         =   "批量JSON格式数据"
         DataField       =   ""
         DataSource      =   ""
         Enabled         =   True
         Height          =   20
         HelpTag         =   ""
         Index           =   -2147483648
         InitialParent   =   "GroupBox3"
         Italic          =   ""
         Left            =   356
         LockBottom      =   ""
         LockedInPosition=   False
         LockLeft        =   True
         LockRight       =   ""
         LockTop         =   True
         Scope           =   0
         State           =   0
         TabIndex        =   3
         TabPanelIndex   =   0
         TabStop         =   True
         TextFont        =   "System"
         TextSize        =   0
         TextUnit        =   0
         Top             =   443
         Underline       =   ""
         Value           =   False
         Visible         =   True
         Width           =   137
      End
   End
   Begin RoundRectangle stSerial
      AutoDeactivate  =   True
      BorderColor     =   0
      BorderWidth     =   1
      Enabled         =   True
      FillColor       =   8355711
      Height          =   16
      HelpTag         =   ""
      Index           =   -2147483648
      InitialParent   =   ""
      Left            =   76
      LockBottom      =   ""
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   ""
      LockTop         =   True
      OvalHeight      =   16
      OvalWidth       =   16
      Scope           =   0
      TabIndex        =   5
      TabPanelIndex   =   0
      Top             =   481
      Visible         =   True
      Width           =   35
   End
   Begin Label Label5
      AutoDeactivate  =   True
      Bold            =   ""
      DataField       =   ""
      DataSource      =   ""
      Enabled         =   True
      Height          =   20
      HelpTag         =   ""
      Index           =   -2147483648
      InitialParent   =   ""
      Italic          =   ""
      Left            =   66
      LockBottom      =   ""
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   ""
      LockTop         =   True
      Multiline       =   ""
      Scope           =   0
      Selectable      =   False
      TabIndex        =   6
      TabPanelIndex   =   0
      Text            =   "串口状态"
      TextAlign       =   0
      TextColor       =   0
      TextFont        =   "System"
      TextSize        =   0
      TextUnit        =   0
      Top             =   500
      Transparent     =   False
      Underline       =   ""
      Visible         =   True
      Width           =   55
   End
   Begin RoundRectangle stNet
      AutoDeactivate  =   True
      BorderColor     =   0
      BorderWidth     =   1
      Enabled         =   True
      FillColor       =   2139062016
      Height          =   16
      HelpTag         =   ""
      Index           =   -2147483648
      InitialParent   =   ""
      Left            =   143
      LockBottom      =   ""
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   ""
      LockTop         =   True
      OvalHeight      =   16
      OvalWidth       =   16
      Scope           =   0
      TabIndex        =   7
      TabPanelIndex   =   0
      Top             =   481
      Visible         =   True
      Width           =   35
   End
   Begin Label Label6
      AutoDeactivate  =   True
      Bold            =   ""
      DataField       =   ""
      DataSource      =   ""
      Enabled         =   True
      Height          =   20
      HelpTag         =   ""
      Index           =   -2147483648
      InitialParent   =   ""
      Italic          =   ""
      Left            =   133
      LockBottom      =   ""
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   ""
      LockTop         =   True
      Multiline       =   ""
      Scope           =   0
      Selectable      =   False
      TabIndex        =   8
      TabPanelIndex   =   0
      Text            =   "联机状态"
      TextAlign       =   0
      TextColor       =   0
      TextFont        =   "System"
      TextSize        =   0
      TextUnit        =   0
      Top             =   500
      Transparent     =   False
      Underline       =   ""
      Visible         =   True
      Width           =   55
   End
   Begin Label Label7
      AutoDeactivate  =   True
      Bold            =   True
      DataField       =   ""
      DataSource      =   ""
      Enabled         =   False
      Height          =   20
      HelpTag         =   ""
      Index           =   -2147483648
      InitialParent   =   ""
      Italic          =   ""
      Left            =   343
      LockBottom      =   ""
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   ""
      LockTop         =   True
      Multiline       =   ""
      Scope           =   0
      Selectable      =   False
      TabIndex        =   9
      TabPanelIndex   =   0
      Text            =   "Powered by www.yeeLink.net"
      TextAlign       =   0
      TextColor       =   0
      TextFont        =   "System"
      TextSize        =   0
      TextUnit        =   0
      Top             =   500
      Transparent     =   False
      Underline       =   ""
      Visible         =   True
      Width           =   177
   End
   Begin PushButton btnBatchUpload
      AutoDeactivate  =   True
      Bold            =   ""
      ButtonStyle     =   5
      Cancel          =   ""
      Caption         =   "批量上传"
      Default         =   ""
      Enabled         =   True
      Height          =   39
      HelpTag         =   ""
      Index           =   -2147483648
      InitialParent   =   ""
      Italic          =   ""
      Left            =   550
      LockBottom      =   ""
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   ""
      LockTop         =   True
      Scope           =   0
      TabIndex        =   10
      TabPanelIndex   =   0
      TabStop         =   True
      TextFont        =   "System"
      TextSize        =   0
      TextUnit        =   0
      Top             =   490
      Underline       =   ""
      Visible         =   True
      Width           =   80
   End
End
#tag EndWindow

#tag WindowCode
	#tag Event
		Sub Open()
		  timer1.Enabled=False
		  
		  AddBaud
		  
		  AddSerials
		  
		  LoadAPIConfig
		  
		  mdlGlobal.CurrentSerialColor=clGray
		  mdlGlobal.CurrentNetColor=clGray
		  
		  stSerial.FillColor=mdlGlobal.CurrentSerialColor
		  stNet.FillColor=mdlGlobal.CurrentNetColor
		  
		  if System.Network.IsConnected then
		    mdlGlobal.CurrentNetColor=clGreen
		  Else
		    mdlGlobal.CurrentNetColor=clGray
		  End
		  
		  stNet.FillColor=mdlGlobal.CurrentNetColor
		  stNet.Refresh
		  
		  bSerialState=False
		  
		End Sub
	#tag EndEvent


	#tag MenuHandler
		Function mmClearLog() As Boolean Handles mmClearLog.Action
			txtLog.Text =""
			Return True
			
		End Function
	#tag EndMenuHandler

	#tag MenuHandler
		Function mmCloseSerial() As Boolean Handles mmCloseSerial.Action
			
			
		End Function
	#tag EndMenuHandler

	#tag MenuHandler
		Function mmOpenSerial() As Boolean Handles mmOpenSerial.Action
			btnSerial.Push
			
			Return True
			
		End Function
	#tag EndMenuHandler

	#tag MenuHandler
		Function mmRefreshSerials() As Boolean Handles mmRefreshSerials.Action
			AddSerials
			Return True
			
		End Function
	#tag EndMenuHandler

	#tag MenuHandler
		Function 帮助关于() As Boolean Handles 帮助关于.Action
			dim frm as new frmInfo
			frm.ShowModal
			'frm.Close
			frm=nil
			
			Return True
			
		End Function
	#tag EndMenuHandler

	#tag MenuHandler
		Function 帮助联系作者() As Boolean Handles 帮助联系作者.Action
			MsgBox "作者的联系方式 jzopen@yeah.net"
			Return True
			
		End Function
	#tag EndMenuHandler


	#tag Method, Flags = &h0
		Sub AddBaud()
		  cbxBaud.AddRow "2400"
		  cbxBaud.AddRow  "4800"
		  cbxBaud.AddRow  "9600"
		  cbxBaud.AddRow  "19200"
		  cbxBaud.AddRow  "38400"
		  cbxBaud.AddRow  "57600"
		  cbxBaud.AddRow  "115200"
		  
		  cbxBaud.ListIndex=2
		  
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub AddSerials()
		  Dim i as Integer
		  If cbxSerial.ListCount>0 then
		    do until cbxSerial.ListCount=0
		      cbxSerial.RemoveRow(0)
		    Loop
		  End
		  
		  for i=0 to System.SerialPortCount-1
		    cbxSerial.AddRow System.SerialPort(i).Name
		  Next
		  
		  if cbxSerial.ListCount>0 then
		    cbxSerial.ListIndex=0
		  End
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Function CheckAPISettings() As Boolean
		  dim ret as Boolean
		  
		  ret= txtAPIVer.Text<>"" And txtDeviceID.Text <>"" And txtKEY.Text<>"" and txtSensorID.Text <>""
		  
		  Return ret
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub DebugInfo(msg as String, remark as String)
		  txtTestData.AppendText "remark: "+ remark + EndOfLine
		  txtTestData.AppendText "msg:"+EndOfLine
		  txtTestData.AppendText msg
		  txtTestData.AppendText EndOfLine
		  
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Function GetAPIKey() As String
		  dim K as String
		  
		  k= txtKEY.Text
		  
		  Return trim(k)
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Function GetAPIVersion() As String
		  dim v as String
		  
		  v=txtAPIVer.Text
		  
		  Return trim(v)
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Function GetDeviceID() As String
		  dim d as String
		  
		  d=txtDeviceID.Text
		  Return Trim(d)
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Function GetFilter() As String
		  Return txtMsgFilter.Text
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Function GetSensorID() As String
		  dim s As String
		  
		  s=txtSensorID.Text
		  Return trim(s)
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Function GetValue(Source as String, Filter as String) As String
		  '从串口数据中提取有效的数值
		  
		  Dim p As Integer
		  dim length as Integer
		  dim ret as string=""
		  'dim digit as string
		  
		  
		  UpdateLog  MESSAGE_RECEIVE_DATA_FROM_SERIAL+ EndOfLine+ Source
		  
		  if Filter="" then //如果没有传感器数据标识，则直接从第一位开始取有效的数字
		    p=1
		  Else
		    p= InStr(Source, Filter)
		    if p=0 then
		      Return ""
		    End
		  End
		  
		  length=len(Filter)
		  p=p+length
		  
		  do until not IsValidDigit(mid(Source,p,1))
		    ret = ret + mid(Source,p,1)
		    p=p+1
		  Loop
		  
		  'MsgBox Source
		  'msgbox ret
		  
		  
		  'DebugInfo(Source,"source")
		  'DebugInfo(ret,"return value")
		  
		  UpdateLog MESSAGE_PARSE_DATA+ ret
		  
		  Return  ret
		  
		  
		  
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Function IsValidDigit(Value as String) As Boolean
		  dim ret as Boolean=False
		  
		  Select case Value
		  case "-","0" to "9","."," "
		    ret=True
		  Else
		    ret=False
		  end Select
		  
		  Return ret
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub LoadAPIConfig()
		  dim api as new clsAPI
		  
		  txtDeviceID.Text= api.GetDeviceID
		  txtSensorID.Text =api.GetSensorID
		  txtAPIVer.Text=api.GetAPIVersion
		  txtMsgFilter.Text=api.GetValueFlag
		  txtkey.Text= api.GetAPIKey
		  if api.GetDisplayKey then
		    chkShowKey.State= CheckBox.CheckedStates.Checked
		  else
		    chkShowKey.state=CheckBox.CheckedStates.Unchecked
		  end
		  
		  api=nil
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Function Now() As Date
		  return new Date
		  
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub SendData(value As String)
		  'post data to yeelink.net
		  
		  dim postData as String
		  
		  HTTPSocket1.ClearRequestHeaders
		  HTTPSocket1.requestHeaders.AppendHeader ("U-ApiKey: ",GetAPIKey)
		  postData=value    ' "{"+   chr(34)+"value"+chr(34)+":"  + value +"}"
		  HTTPSocket1.SetPostContent  (postData , "application/json;charset=utf-8")
		  
		  HTTPSocket1.Post "http://api.yeelink.net/"+   GetAPIVersion+  "/device/"+GetDeviceID +"/sensor/"+ GetSensorID+"/datapoints"
		  
		  UpdateLog MESSAGE_SEND_DATA+ value
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub SendJSONData(jsonString as String)
		  SendData jsonString
		  
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub SendSingleValueAsString(value as String)
		  dim s as String
		  s="{"+   chr(34)+"value"+chr(34)+":"  + value +"}"
		  SendData s
		  
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Function TimeToUnixtime() As integer
		  dim Now as new Date
		  dim base as new Date
		  
		  base.Year=1970
		  base.Month=1
		  base.Day=1
		  base.Hour=0
		  base.Minute=0
		  base.Second=0
		  
		  dim uStamp as Int32
		  
		  uStamp= now.TotalSeconds - base.TotalSeconds
		  
		  return uStamp
		  
		  
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub UpdateLog(Message as String)
		  dim t as String=""
		  
		  t=str(Now)+EndOfLine
		  t=t+"    "+Message+EndOfLine
		  t=t+txtLog.Text
		  't= t.ConvertEncoding(Encodings.UTF8)
		  
		  txtLog.Text=t
		  
		  'txtLog.Refresh
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub UpdateNETStatus()
		  dim i as Integer
		  for i=0 to 10
		    stnet.FillColor=clBlack
		    stnet.Refresh
		    stNet.FillColor=mdlGlobal.CurrentNetColor
		    stnet.Refresh
		  Next
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub UpdateSerialButtonCaption(opened as Boolean)
		  if opened then
		    btnSerial.Caption="断开"
		    mdlGlobal.CurrentSerialColor=clGreen
		  else
		    btnSerial.Caption="连接"
		    mdlGlobal.CurrentSerialColor=clGray
		  End
		  
		  stSerial.FillColor=mdlGlobal.CurrentSerialColor
		  stSerial.Refresh
		  
		  btnSerial.Default=Not opened
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub UpdateSerialStatus()
		  dim i as Integer
		  for i=0 to 10
		    stSerial.FillColor= clBlack
		    stSerial.Refresh
		    stSerial.FillColor=mdlGlobal.CurrentSerialColor
		    stSerial.Refresh
		  next
		End Sub
	#tag EndMethod


	#tag Note, Name = Copyrights
		
		本软件是www.yeelink.net物联网平台的客户端，灵感来自于官网的C#串口工具，它从串口设备采集数据，然后发布到yeelink网站，方便那些没有网络模块或者串口服务器等硬件的使用者发布数据。
		
		本软件是免费软件，可以自由分发，但不得因此获利。
		
		
		本软件最新版本可以在下面地址获得：
		https://code.google.com/p/yeeserial/
		
		
		
		
		使用方法：
		
		使用之前，需要先在www.yeelink.net网站注册，取得专属的API KEY，以及设备编号和传感器编号。
		
		使用时，将计算机与串口设备相连，在串口设备列表中选择相应的串口设备名称，波特率必须跟串口设备的波特率设置保持一致。同时，将API参数填入传感器设置一栏。设置好之后，单击连接。连接正常之后，串口状态指示灯便会由灰色变为绿色，采集到数据时，便会闪烁。发布数据时，网络状态指示灯也会闪烁。
		
		API版本目前为v1.0，因此目前不要输入其它值，待以后API版本升级后再根据需要调整。
		
		数据标识是串口设备发送数据时，在数据前面添加的标识，默认为“value:”，可以根据你的设备发送协议修改。
		
		
		服务器联机测试功能是检测PC至www.yeelink.net服务器之间的通信链路是否正常，输入一个模拟的传感器数值之后，单击发送，如果链路正常，在日志窗口会显示发布成功，否则会显示其它提示信息。
		
		
		
		
		已知问题：
		
		本软件仅在Mac OS LION 10.7.4和Window 7 x64 CHS两个平台上做过测试，在其它平台可能会出现一些问题。目前已知的问题有：
		
		1.  在Mac平台使用时，打开本软件一段时间之后再开启串口，串口缓冲区会收到软件打开以来串口设备发送的数据，因为根据1.0版本API的规则，两次发布数据之间的时间间隔不少于10秒，所以这些数据会被忽略。
		2.  在Mac平台使用时，偶尔会遇到接收到的数据紊乱情况，解决办法是尽可能减少串口设备每次发送的数据的长度，或者降低波特率。
		
		在使用过程中，如果发现bug，请与作者联系 jzopen@yeah.net
		
		
		
		Ardypro @ 2012
	#tag EndNote

	#tag Note, Name = TODO
		1  将API Key移到form open事件
		2
	#tag EndNote


	#tag Property, Flags = &h0
		bSerialState As Boolean = False
	#tag EndProperty

	#tag Property, Flags = &h0
		LastHttpStatus As Integer
	#tag EndProperty

	#tag Property, Flags = &h0
		strBatchJSON As String = """"""
	#tag EndProperty


	#tag Constant, Name = clBlack, Type = Color, Dynamic = False, Default = \"&c000000", Scope = Public
	#tag EndConstant

	#tag Constant, Name = clGray, Type = Color, Dynamic = False, Default = \"&cB3B3B3", Scope = Public
	#tag EndConstant

	#tag Constant, Name = clGreen, Type = Color, Dynamic = False, Default = \"&c00FF00", Scope = Public
	#tag EndConstant

	#tag Constant, Name = clRed, Type = Color, Dynamic = False, Default = \"&cFF0000", Scope = Public
	#tag EndConstant

	#tag Constant, Name = clYellow, Type = Color, Dynamic = False, Default = \"&cFFFF00", Scope = Public
	#tag EndConstant

	#tag Constant, Name = MESSAGE_CLOSE_SERIAL, Type = String, Dynamic = False, Default = \"\xE5\x85\xB3\xE9\x97\xAD\xE4\xB8\xB2\xE5\x8F\xA3\xEF\xBC\x9A", Scope = Public
		#Tag Instance, Platform = Mac OS, Language = Default, Definition  = \"\xE5\x85\xB3\xE9\x97\xAD\xE4\xB8\xB2\xE5\x8F\xA3\xEF\xBC\x9A"
		#Tag Instance, Platform = Windows, Language = Default, Definition  = \"\xE5\x85\xB3\xE9\x97\xAD\xE4\xB8\xB2\xE5\x8F\xA3\xEF\xBC\x9A"
		#Tag Instance, Platform = Linux, Language = Default, Definition  = \"Close Serial Port: "
	#tag EndConstant

	#tag Constant, Name = MESSAGE_OPEN_SERIAL, Type = String, Dynamic = False, Default = \"\xE6\x89\x93\xE5\xBC\x80\xE4\xB8\xB2\xE5\x8F\xA3: ", Scope = Public
		#Tag Instance, Platform = Mac OS, Language = Default, Definition  = \"\xE6\x89\x93\xE5\xBC\x80\xE4\xB8\xB2\xE5\x8F\xA3\xEF\xBC\x9A "
		#Tag Instance, Platform = Windows, Language = Default, Definition  = \"\xE6\x89\x93\xE5\xBC\x80\xE4\xB8\xB2\xE5\x8F\xA3: "
		#Tag Instance, Platform = Linux, Language = Default, Definition  = \"Open Serial Port: "
	#tag EndConstant

	#tag Constant, Name = MESSAGE_OTHER_SERVER_STATUS, Type = String, Dynamic = False, Default = \"\xE6\x9C\x8D\xE5\x8A\xA1\xE5\x99\xA8\xE8\xBF\x94\xE5\x9B\x9E\xE5\x85\xB6\xE5\xAE\x83\xE7\x8A\xB6\xE6\x80\x81\xE5\x80\xBC\xEF\xBC\x8C\xE8\xAF\xB7\xE5\x8F\x82\xE8\x80\x83API\xE6\x89\x8B\xE5\x86\x8C\xEF\xBC\x81", Scope = Public
		#Tag Instance, Platform = Mac OS, Language = Default, Definition  = \"\xE5\x85\xB6\xE5\xAE\x83\xE9\x94\x99\xE8\xAF\xAF"
		#Tag Instance, Platform = Windows, Language = Default, Definition  = \"\xE5\x85\xB6\xE5\xAE\x83\xE9\x94\x99\xE8\xAF\xAF"
		#Tag Instance, Platform = Linux, Language = Default, Definition  = \"Server Returned Other Code\x2C Please Refer to API Manual"
	#tag EndConstant

	#tag Constant, Name = MESSAGE_PARSE_DATA, Type = String, Dynamic = False, Default = \"\xE8\xA7\xA3\xE6\x9E\x90\xE5\x88\xB0\xE6\x95\xB0\xE6\x8D\xAE\xEF\xBC\x9A", Scope = Public
		#Tag Instance, Platform = Mac OS, Language = Default, Definition  = \"\xE8\xA7\xA3\xE6\x9E\x90\xE5\x88\xB0\xE6\x95\xB0\xE6\x8D\xAE\xEF\xBC\x9A"
		#Tag Instance, Platform = Windows, Language = Default, Definition  = \"\xE6\x95\xB0\xE6\x8D\xAE\xEF\xBC\x9A "
		#Tag Instance, Platform = Linux, Language = Default, Definition  = \"Value: "
	#tag EndConstant

	#tag Constant, Name = MESSAGE_RECEIVE_DATA_FROM_SERIAL, Type = String, Dynamic = False, Default = \"\xE4\xBB\x8E\xE4\xB8\xB2\xE5\x8F\xA3\xE6\x8E\xA5\xE6\x94\xB6\xE5\x88\xB0\xE6\x95\xB0\xE6\x8D\xAE\xEF\xBC\x9A", Scope = Public
		#Tag Instance, Platform = Mac OS, Language = Default, Definition  = \"\xE4\xBB\x8E\xE4\xB8\xB2\xE5\x8F\xA3\xE6\x8E\xA5\xE6\x94\xB6\xE5\x88\xB0\xE6\x95\xB0\xE6\x8D\xAE\xEF\xBC\x9A"
		#Tag Instance, Platform = Windows, Language = Default, Definition  = \"\xE4\xBB\x8E\xE4\xB8\xB2\xE5\x8F\xA3\xE6\x8D\x95\xE8\x8E\xB7\xE5\x88\xB0\xE6\x95\xB0\xE6\x8D\xAE\xEF\xBC\x9A"
		#Tag Instance, Platform = Linux, Language = Default, Definition  = \"Received Data From Serial Port:"
	#tag EndConstant

	#tag Constant, Name = MESSAGE_SEND_DATA, Type = String, Dynamic = False, Default = \"\xE6\xAD\xA3\xE5\x9C\xA8\xE5\x8F\x91\xE9\x80\x81\xE6\x95\xB0\xE6\x8D\xAE\xEF\xBC\x9A", Scope = Public
		#Tag Instance, Platform = Mac OS, Language = Default, Definition  = \"\xE6\xAD\xA3\xE5\x9C\xA8\xE5\x8F\x91\xE9\x80\x81\xEF\xBC\x9A "
		#Tag Instance, Platform = Windows, Language = Default, Definition  = \"\xE6\xAD\xA3\xE5\x9C\xA8\xE5\x8F\x91\xE9\x80\x81\xEF\xBC\x9A"
		#Tag Instance, Platform = Linux, Language = Default, Definition  = \"Sending Value: "
	#tag EndConstant

	#tag Constant, Name = MESSAGE_SENT_SUCCESS, Type = String, Dynamic = False, Default = \"\xE5\x8F\x91\xE5\xB8\x83\xE6\x88\x90\xE5\x8A\x9F", Scope = Public
		#Tag Instance, Platform = Mac OS, Language = Default, Definition  = \"\xE4\xB8\x8A\xE4\xBC\xA0\xE6\x88\x90\xE5\x8A\x9F"
		#Tag Instance, Platform = Windows, Language = Default, Definition  = \"\xE4\xB8\x8A\xE4\xBC\xA0\xE6\x88\x90\xE5\x8A\x9F"
		#Tag Instance, Platform = Linux, Language = Default, Definition  = \"Published Successfully"
	#tag EndConstant

	#tag Constant, Name = MESSAGE_SERIAL_BUSY, Type = String, Dynamic = False, Default = \"\xE4\xB8\xB2\xE5\x8F\xA3\xE4\xB8\x8D\xE5\xAD\x98\xE5\x9C\xA8\xE6\x88\x96\xE8\x80\x85\xE8\xA2\xAB\xE5\x8D\xA0\xE7\x94\xA8\xEF\xBC\x8C\xE6\x97\xA0\xE6\xB3\x95\xE6\x89\x93\xE5\xBC\x80", Scope = Public
		#Tag Instance, Platform = Mac OS, Language = Default, Definition  = \"\xE4\xB8\xB2\xE5\x8F\xA3\xE4\xB8\x8D\xE5\xAD\x98\xE5\x9C\xA8\xE6\x88\x96\xE8\x80\x85\xE8\xA2\xAB\xE5\x8D\xA0\xE7\x94\xA8\xEF\xBC\x8C\xE6\x97\xA0\xE6\xB3\x95\xE6\x89\x93\xE5\xBC\x80"
		#Tag Instance, Platform = Windows, Language = Default, Definition  = \"\xE4\xB8\xB2\xE5\x8F\xA3\xE4\xB8\x8D\xE5\xAD\x98\xE5\x9C\xA8\xE6\x88\x96\xE8\x80\x85\xE8\xA2\xAB\xE5\x8D\xA0\xE7\x94\xA8\xEF\xBC\x8C\xE6\x97\xA0\xE6\xB3\x95\xE6\x89\x93\xE5\xBC\x80"
		#Tag Instance, Platform = Linux, Language = Default, Definition  = \"Serial Port Not Exist Or Busy"
	#tag EndConstant

	#tag Constant, Name = MESSAGE_SERVER_BUSY, Type = String, Dynamic = False, Default = \"\xE6\x9C\x8D\xE5\x8A\xA1\xE5\x99\xA8\xE5\xBF\x99", Scope = Public
		#Tag Instance, Platform = Mac OS, Language = Default, Definition  = \"\xE6\x9C\x8D\xE5\x8A\xA1\xE5\x99\xA8\xE5\xBF\x99"
		#Tag Instance, Platform = Windows, Language = Default, Definition  = \"\xE6\x9C\x8D\xE5\x8A\xA1\xE5\x99\xA8\xE5\xBF\x99"
		#Tag Instance, Platform = Linux, Language = Default, Definition  = \"Server Busy"
	#tag EndConstant

	#tag Constant, Name = MSSAGE_INTERNET_DISCONNECTED, Type = String, Dynamic = False, Default = \"\xE7\xBD\x91\xE7\xBB\x9C\xE5\xBC\x82\xE5\xB8\xB8\xEF\xBC\x8C\xE6\x97\xA0\xE6\xB3\x95\xE8\xBF\x9E\xE6\x8E\xA5\xE6\x9C\x8D\xE5\x8A\xA1\xE5\x99\xA8", Scope = Public
	#tag EndConstant


#tag EndWindowCode

#tag Events cbxSerial
	#tag Event
		Sub Change()
		  btnSerial.Enabled = cbxBaud.ListIndex<>-1 and cbxSerial.ListIndex<>-1
		  btnSerial.Default=btnSerial.Enabled
		  
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events cbxBaud
	#tag Event
		Sub Change()
		  btnSerial.Enabled = cbxBaud.ListIndex<>-1 and cbxSerial.ListIndex<>-1
		  btnSerial.Default=btnSerial.Enabled
		  
		  
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events btnSerial
	#tag Event
		Sub Action()
		  if bSerialState then
		    Serial1.Close
		    bSerialState=False
		    
		    'UpdateLog "关闭串口"+ Serial1.SerialPort.Name+EndOfLine
		    UpdateLog  MESSAGE_CLOSE_SERIAL+  Serial1.SerialPort.Name+EndOfLine
		    
		  Else
		    Serial1.SerialPort= System.SerialPort(cbxSerial.ListIndex)
		    
		    if not CheckAPISettings then
		      MsgBox "API参数尚未设置完成！"
		    End
		    
		    if Serial1.Open then
		      if Serial1.BytesAvailable>0 then
		        Serial1.Flush   'application打开之后，尽管串口尚未打开，但是device发送来的数据已经开始进入串口缓冲区
		      End
		      bSerialState=True
		      
		      UpdateLog MESSAGE_OPEN_SERIAL+Serial1.SerialPort.Name+EndOfLine
		      
		    Else
		      bSerialState=False
		      MsgBox MESSAGE_SERIAL_BUSY
		      
		    End
		    
		  End
		  
		  UpdateSerialButtonCaption(bSerialState)
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events txtDeviceID
	#tag Event
		Sub LostFocus()
		  '将修改后的数据保存到配置文件
		  dim api as new clsAPI
		  api.SetDeviceID txtDeviceID.Text
		  api=nil
		  
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events txtKEY
	#tag Event
		Sub LostFocus()
		  dim api as new clsAPI
		  api.SetAPIKey txtKEY.Text
		  api=nil
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events chkShowKey
	#tag Event
		Sub Action()
		  txtKEY.Password = not ( chkShowKey.State=CheckBox.CheckedStates.Checked)
		  dim api as new clsAPI
		  if chkShowKey.state= CheckBox.CheckedStates.Checked then
		    api.SetDisplayKey True
		  else
		    api.SetDisplayKey False
		  end
		  api=nil
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events txtSensorID
	#tag Event
		Sub LostFocus()
		  dim api as new clsAPI
		  api.SetSensorID txtSensorID.Text
		  api=nil
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events txtMsgFilter
	#tag Event
		Sub LostFocus()
		  dim api as new clsAPI
		  api.SetValueFlag txtMsgFilter.Text
		  api=nil
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events txtAPIVer
	#tag Event
		Sub LostFocus()
		  dim api as new clsAPI
		  api.SetAPIVersion txtAPIVer.Text
		  api=nil
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events txtLog
	#tag Event
		Function ConstructContextualMenu(base as MenuItem, x as Integer, y as Integer) As Boolean
		  base.Append EditClear
		  base.Append EditCopy
		  base.Append EditSelectAll
		  base.Append EditCut
		End Function
	#tag EndEvent
#tag EndEvents
#tag Events txtTestData
	#tag Event
		Sub TextChange()
		  btnClear.Enabled= txtTestData.Text <>"" and txtdeviceid.Text<>"" and txtKEY.Text<>"" and txtSensorID.Text<>""
		  btnSend.Enabled=txtTestData.Text<>"" and txtdeviceid.Text<>"" and txtKEY.Text<>"" and txtSensorID.Text<>""
		  
		End Sub
	#tag EndEvent
	#tag Event
		Function ConstructContextualMenu(base as MenuItem, x as Integer, y as Integer) As Boolean
		  base.Append EditClear
		  base.Append EditPaste
		End Function
	#tag EndEvent
#tag EndEvents
#tag Events Serial1
	#tag Event
		Sub DataAvailable()
		  Timer1.Enabled=True
		  UpdateSerialStatus
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events HTTPSocket1
	#tag Event
		Sub Connected()
		  if HTTPSocket1.IsConnected then
		    stNet.FillColor = clGreen
		  else
		    stNet.FillColor=clGray
		  end
		  
		  stNet.Refresh
		  
		End Sub
	#tag EndEvent
	#tag Event
		Sub HeadersReceived(headers as internetHeaders, httpStatus as integer)
		  Select case httpStatus
		  case 200
		    UpdateLog MESSAGE_SENT_SUCCESS
		  case 406
		    UpdateLog  MESSAGE_SERVER_BUSY
		  Else
		    //MsgBox headers.Value
		    MsgBox str(httpStatus)
		    UpdateLog MESSAGE_OTHER_SERVER_STATUS
		  end Select
		  
		  LastHttpStatus=httpStatus
		  
		  'if (headers.Count<>0) then
		  'MsgBox (headers.Source)
		  'end if
		  
		  UpdateNETStatus
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events Timer1
	#tag Event
		Sub Action()
		  '临时解决方案，延时之后再接收串口数据
		  dim Source as String
		  dim Value as String
		  
		  Source= Serial1.ReadAll
		  Value = GetValue(Source,GetFilter)
		  if Value<>"" then
		    txtTestData.Text=Value
		    SendData Value
		  End
		  
		  Timer1.Enabled=False
		  
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events tmrClearLog
	#tag Event
		Sub Action()
		  txtLog.Text=""
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events btnSend
	#tag Event
		Sub Action()
		  if (chkBatch.State= CheckBox.CheckedStates.Checked) then 
		    SendJSONData txtTestData.Text
		  Else 
		    SendSingleValueAsString txtTestData.Text
		    
		  End If
		  
		  
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events btnClear
	#tag Event
		Sub Action()
		  txtTestData.Text=""
		  
		  
		  
		  
		  
		End Sub
	#tag EndEvent
	#tag Event
		Sub Close()
		  Quit
		  
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events btnBatchUpload
	#tag Event
		Sub Action()
		  dim bu as new frmBatchUpload
		  
		  bu.ShowModal
		  
		  bu.Close
		  bu=Nil
		  
		  '批量上传
		  if (strBatchJSON<>"") then 
		    SendJSONData strBatchJSON
		  end if 
		End Sub
	#tag EndEvent
#tag EndEvents
